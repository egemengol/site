{% extends "base.html" %}

{% block stylesheet %}/blog.css{% endblock stylesheet %}

{% block title %}{{ taxonomy.name | capitalize }}: {{ term.name }}{% endblock title %}

{% block content %}
<div class="blog-list">
    <h1>{{ taxonomy.name | capitalize }}: {{ term.name }}</h1>
    
    <div class="term-description">
        <p>Showing all posts with the {{ taxonomy.name }} "{{ term.name }}".</p>
    </div>
    
    {% if term.pages %}
        {% set sorted_pages = term.pages | sort(attribute="date") | reverse %}
        
        {% for page in sorted_pages %}
        <article class="blog-post-preview">
            <div class="post-meta">
                <div class="post-date">
                    <span class="material-symbols-outlined">calendar_today</span>
                    {{ page.date | date(format="%B %d, %Y") }}
                </div>
                
                {% if page.taxonomies.series %}
                <div class="post-tags">
                    <span class="material-symbols-outlined">bookmarks</span>
                    {% for series in page.taxonomies.series %}
                    <a href="{{ get_taxonomy_url(kind="series", name=series) }}" 
                       class="tag {% if taxonomy.name == 'series' and series == term.name %}active{% endif %}">{{ series }}</a>
                    {% endfor %}
                </div>
                {% endif %}
                
                {% if page.taxonomies.categories %}
                <div class="post-tags">
                    <span class="material-symbols-outlined">folder</span>
                    {% for category in page.taxonomies.categories %}
                    <a href="{{ get_taxonomy_url(kind="categories", name=category) }}" 
                       class="tag {% if taxonomy.name == 'categories' and category == term.name %}active{% endif %}">{{ category }}</a>
                    {% endfor %}
                </div>
                {% endif %}
                
                {% if page.taxonomies.tags %}
                <div class="post-tags">
                    <span class="material-symbols-outlined">sell</span>
                    {% for tag in page.taxonomies.tags %}
                    <a href="{{ get_taxonomy_url(kind="tags", name=tag) }}" 
                       class="tag {% if taxonomy.name == 'tags' and tag == term.name %}active{% endif %}">{{ tag }}</a>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            
            <h2 class="post-title">
                <a href="{{ page.permalink }}">{{ page.title }}</a>
            </h2>
            
            <div class="post-summary">
                {% if page.summary %}
                    {{ page.summary | safe }}
                {% else %}
                    {{ page.content | striptags | truncate(length=200) }}
                {% endif %}
            </div>
            
            <a href="{{ page.permalink }}" class="read-more">Read More</a>
        </article>
        {% endfor %}
        
        {% if paginator.previous or paginator.next %}
        <div class="pagination">
            {% if paginator.previous %}
            <a class="prev" href="{{ paginator.previous }}">← Previous</a>
            {% endif %}
            
            <span class="page-number">Page {{ paginator.current_index }} of {{ paginator.number_pagers }}</span>
            
            {% if paginator.next %}
            <a class="next" href="{{ paginator.next }}">Next →</a>
            {% endif %}
        </div>
        {% endif %}
    {% else %}
        <p>No posts with this {{ taxonomy.name }} yet.</p>
    {% endif %}
</div>

<style>
    .tag.active {
        background-color: var(--link-color);
        color: white;
    }
</style>
{% endblock content %}